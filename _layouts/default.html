<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!--meta name="description" content="This is the text preview shown on social media websites when the link to this page is shared. You can customize it to provide a brief summary of the page content."--->

{% seo %}

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
<link href="{{ site.url }}/assets/css/screen.css" rel="stylesheet">

<link href="{{ site.url }}/assets/css/tooltip.css" rel="stylesheet">

<link href="{{ site.url }}/assets/css/main.css" rel="stylesheet">

<style>
    a, a:hover, a:focus {
        text-decoration: none !important;
    }
    .navbar-nav .nav-link.current {
        color: #d9230f !important;
        border-bottom: 2px solid #d9230f;
    }
</style>

</head>

{% capture layout %}{% if page.layout %}layout-{{ page.layout }}{% endif %}{% endcapture %}
<body class="{{layout}}">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="{{ site.url }}/">
        <h6 class="sitetitle" style="font-family: Righteous;">
        SHIRISH POKHAREL
        </h6>
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ms-auto">

                <li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/index.html">Blog</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/about">About</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/now">Now</a>
                </li>

                <!--li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/ideas">Steal this Idea!</a>
                </li-->

                <li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/failed-projects">Post Mortems</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/fermentland">Ferment Blog</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/socials">Social Media</a>
                </li>

                <!--li class="nav-item">
                    <a class="nav-link" href="{{ site.url }}/funfacts">Fun Facts</a>
                </li-->

                {% include search-lunr.html %}

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">{{ site.name }}</h1>
    <p class="lead">
        {{ site.description }}
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    {{ content }}
</div>

{% if site.mailchimp-list %}
<!-- Bottom Alert Bar
================================================== -->
<div class="alertbar">
	<div class="container text-center">
		<span><img src="{{ site.url }}/{{ site.logo }}" alt="{{site.title}}"> &nbsp; Never miss a <b>story</b> from us, subscribe to our newsletter</span>
        <form action="{{site.mailchimp-list}}" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate>
            <div class="mc-field-group">
            <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required>
            <input type="submit" value="Subscribe" name="subscribe" class="heart">
            </div>
        </form>
	</div>
</div>
{% endif %}
    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            {% assign categories_list = site.categories %}
            {% if categories_list.first[0] == null %}
                {% for category in categories_list %}
                    <a class="mt-1 mb-1" href="{{site.url}}/categories#{{ category | url_escape | strip | replace: ' ', '-' }}">{{ category | camelcase }} ({{ site.tags[category].size }})</a>
                {% endfor %}
            {% else %}
                {% for category in categories_list %}
                    <a class="mt-1 mb-1" href="{{site.url}}/categories#{{ category[0] | url_escape | strip | replace: ' ', '-' }}">{{ category[0] | camelcase }} ({{ category[1].size }})</a>
                {% endfor %}
            {% endif %}
            {% assign categories_list = nil %}
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © {{ site.time | date: "%Y" }} {{ site.name }} 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net. Jumbotron image by Neena Gurung.
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<!-- Bootstrap 5 JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script src="{{ site.url }}/assets/js/mediumish.js"></script>

{% if site.lazyimages == "enabled" %}
<script src="{{ site.url }}/assets/js/lazyload.js"></script>
{% endif %}


<script src="{{ site.url }}/assets/js/random-image.js"></script>

<!-- Search Modal -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search this site</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="bd-search" onsubmit="return lunr_search(document.getElementById('lunrsearch-modal').value);">
                    <input type="text" class="form-control text-small" id="lunrsearch-modal" name="q" maxlength="255" value="" placeholder="Type and enter..." />
                </form>
                <div id="lunrsearchresults" class="mt-4">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Vanilla JS version of the search loader
    let scriptsLoaded = false;
    var idx, documents; // Make these global for lunrsearchengine.js

    // Helper to load a script and return a promise
    function loadScript(src) {
        return new Promise(function (resolve, reject) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    }

    // This function expands a custom compact Lunr index format.
    function expand(compact) {
        const fields = compact["fields"];
        const fieldVectors = compact["fieldVectors"].map((item) => {
            const id = item[0];
            const vectors = item[1];
            let prev = null;
            const expanded = vectors.map((v, ii) => {
                if (ii % 2 === 0) {
                    if (v === null) { v = prev + 1; }
                    prev = v;
                }
                return v;
            });
            return [id, expanded];
        });
        const invertedIndex = compact["invertedIndex"].map((item, itemIdx) => {
            const token = item[0];
            const fieldMap = {"_index": itemIdx};
            fields.forEach((field, fieldIdx) => {
                const matches = {};
                let docRef = null;
                item[fieldIdx + 1].forEach((v, ii) => {
                    if (ii % 2 === 0) {
                        docRef = fieldVectors[v][0].slice(`${field}/`.length);
                    } else {
                        matches[docRef] = v;
                    }
                });
                fieldMap[field] = matches;
            });
            return [token, fieldMap];
        });
        invertedIndex.sort((a, b) => {
            if (a[0] < b[0]) return -1;
            if (a[0] > b[0]) return 1;
            return 0;
        });
        return {
            "version": compact["version"], "fields": fields, "fieldVectors": fieldVectors,
            "invertedIndex": invertedIndex, "pipeline": compact["pipeline"],
        };
    }

    const searchModal = document.getElementById('searchModal');
    const searchInput = document.getElementById('lunrsearch-modal');

    // Load scripts when the modal is shown for the first time
    searchModal.addEventListener('shown.bs.modal', function loadLunrOnce() {
        searchInput.focus(); // Focus on the input inside the modal
        if (scriptsLoaded) return;
        scriptsLoaded = true; // Prevent re-loading

        console.log("Loading search scripts...");

        Promise.all([
            loadScript("{{site.url}}/assets/js/lunr.js"),
            fetch("{{site.url}}/assets/js/documents.json").then(res => res.json()),
            fetch("/assets/js/idx.json").then(res => res.json())
        ]).then(([lunrScript, searchData, compactedIndex]) => {
            // Create a simple lookup table for documents by their ID
            documents = {};
            searchData.forEach(function(doc) {
                documents[doc.id] = doc;
            });

            const serializedIndex = expand(compactedIndex);
            idx = lunr.Index.load(serializedIndex);
        }).then(() => {
            console.log("Search is ready.");
        }).catch(error => {
            console.error("Error loading search functionality:", error);
        });
    }, { once: true });

    function lunr_search(query) {
        const result_list = document.querySelector('#lunrsearchresults ul');
        if (!idx) {
            result_list.innerHTML = '<li>Search index not loaded yet. Please try again in a moment.</li>';
            return false;
        }
        
        result_list.innerHTML = '<li>Searching...</li>';
        const results = idx.search(query);

        if (results.length === 0) {
            result_list.innerHTML = '<li>No results found.</li>';
            return false;
        }

        result_list.innerHTML = ''; // Clear "Searching..." message

        results.slice(0, 10).forEach(result => {
            const docId = result.ref;
            const doc = documents[docId];
            if (doc) {
                const listItem = document.createElement('li');
                listItem.classList.add('lunrsearchresult');
                listItem.innerHTML = `<a href="${doc.url}"><span class="title">${doc.title}</span><br><span class="blurb">${doc.body}</span></a>`;
                result_list.appendChild(listItem);
            }
        });

        return false; // Prevent form submission
    }

    function triggerSearch(event) {
        event.preventDefault();
        const query = document.getElementById('navbar-search').value;
        
        const searchModalEl = document.getElementById('searchModal');
        const searchModal = bootstrap.Modal.getOrCreateInstance(searchModalEl);
        
        const modalSearchInput = document.getElementById('lunrsearch-modal');
        modalSearchInput.value = query;
        
        searchModal.show();

        if (query) {
            // if scripts are already loaded, search immediately.
            // otherwise, the 'shown.bs.modal' event will load them,
            // and we attach a one-time listener to search after that.
            if (scriptsLoaded) { lunr_search(query); } 
            else { searchModalEl.addEventListener('shown.bs.modal', () => lunr_search(query), { once: true }); }
        }
    }
</script>

</body>
</html>
